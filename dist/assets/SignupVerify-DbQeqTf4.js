import{u as M,c as T,r as o,i as V,j as t,k as P}from"./index-CU_iZQyH.js";import{i as C}from"./index-0Q7cGwnK.js";function R(){const y=M(),n=T(),[c,f]=o.useState(["","","",""]),[d,g]=o.useState(60),[m,p]=o.useState(!1),[h,i]=o.useState(null),l=o.useRef([]),[b]=V(),u=o.useMemo(()=>{const e=n.state?.email;return e||(new URLSearchParams(n.search).get("email")??"")},[n.state,n.search]),v=o.useMemo(()=>{const e=n.state?.from;return e||(new URLSearchParams(n.search).get("redirect")??"/dashboard")},[n.state,n.search]);o.useEffect(()=>{if(d<=0)return;const e=setInterval(()=>g(s=>s-1),1e3);return()=>clearInterval(e)},[d]);const w=(e,s)=>{const r=s.replace(/[^a-zA-Z0-9]/g,"").slice(0,1).toUpperCase(),a=[...c];a[e]=r,f(a),r&&e<l.current.length-1&&l.current[e+1]?.focus()},j=(e,s)=>{s.key==="Backspace"&&!c[e]&&e>0&&l.current[e-1]?.focus()},x=c.every(e=>e.length===1),S=()=>{f(["","","",""]),g(60),i(null),l.current[0]?.focus()},k=async e=>{if(e.preventDefault(),!u){i("Verification link is missing an email. Please reopen the verification link.");return}const s=c.join("");p(!0),i(null);try{const a=(await b({token:s,email:u}).unwrap())?.data;if(!a?.accessToken||!a?.refreshToken){i("Verification response is missing credentials. Please try again.");return}P({accessToken:a.accessToken,refreshToken:a.refreshToken}),y("/auth/signup/verified",{state:{message:a?.message,redirectTo:v},replace:!0})}catch(r){if(C(r)){const a=r.response?.data?.message;i(a||"We could not verify your account. Please check the code and try again.")}else i("Something went wrong while verifying. Please try again later.")}finally{p(!1)}},N=String(Math.floor(d/60)).padStart(2,"0"),E=String(d%60).padStart(2,"0");return t.jsxs("div",{className:"w-full max-w-md",children:[t.jsx("h1",{className:"text-[30px] sm:text-3xl lg:text-[50px] font-semibold text-secondary",children:"Just One More Step"}),t.jsx("p",{className:"text-gray-600 mt-2",children:"We’ve sent a 4-digit code to your email. Enter it below to verify your account."}),t.jsxs("form",{onSubmit:k,className:"mt-8 space-y-5",children:[u?null:t.jsx("div",{className:"rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700",children:"We could not detect your email address. Please return to signup and try again."}),h?t.jsx("div",{role:"alert",className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-600",children:h}):null,t.jsx("div",{className:"flex gap-3",children:c.map((e,s)=>t.jsx("input",{ref:r=>{l.current[s]=r},value:e,onChange:r=>w(s,r.target.value),onKeyDown:r=>j(s,r),inputMode:"text",pattern:"[A-Za-z0-9]*",maxLength:1,"aria-label":`OTP digit ${s+1}`,className:"w-12 h-12 text-center rounded-lg bg-[#F5F7FB] border border-[#E6EAF2] focus:ring-2 focus:ring-primary focus:border-transparent outline-none text-base"},s))}),t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[t.jsxs("span",{children:["Your verification code expires in:"," ",t.jsxs("span",{className:"text-green-600 font-medium",children:[N,":",E]})]}),t.jsx("button",{type:"button",onClick:S,className:"text-gray-600 hover:underline",children:"Resend Code"})]}),t.jsx("button",{type:"submit",className:`w-full py-3 rounded-lg transition-all flex items-center justify-center gap-2 ${x&&u?"bg-secondary text-white hover:opacity-95":"bg-gray-300 text-white cursor-not-allowed"} ${m?"scale-[0.99] animate-pulse":""}`,disabled:!x||!u||m,"aria-busy":m?"true":"false",children:m?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"h-4 w-4 rounded-full border-2 border-white/70 border-t-white animate-spin"}),t.jsx("span",{children:"Verifying…"})]}):"Verify Now"})]})]})}export{R as default};
